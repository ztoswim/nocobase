{"level":"error","message":"Unable to connect to the database","stack":"Error: Unable to connect to the database\n    at _AsyncEmitter.auth (/app/nocobase/node_modules/@nocobase/database/lib/database.js:641:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async _AsyncEmitter.authenticate (/app/nocobase/node_modules/@nocobase/server/lib/application.js:470:5)\n    at async Object.callback (/app/nocobase/node_modules/@nocobase/server/lib/application.js:797:9)\n    at async _AppCommand.parseAsync (/app/nocobase/node_modules/@nocobase/server/node_modules/commander/lib/command.js:935:5)\n    at async _AsyncEmitter.runAsCLI (/app/nocobase/node_modules/@nocobase/server/lib/application.js:557:23)","meta":{},"module":"application","submodule":"","method":"","app":"main","reqId":"5326c9d3-b53a-479c-8852-811af36b07ad","dataSourceKey":"main","timestamp":"2025-04-23 03:27:29"}
{"level":"error","message":"the database system is starting up","stack":"SequelizeConnectionError: the database system is starting up\n    at Client._connectionCallback (/app/nocobase/node_modules/sequelize/lib/dialects/postgres/connection-manager.js:145:24)\n    at Client._handleErrorWhileConnecting (/app/nocobase/node_modules/pg/lib/client.js:336:19)\n    at Client._handleErrorMessage (/app/nocobase/node_modules/pg/lib/client.js:356:19)\n    at Connection.emit (node:events:524:28)\n    at Connection.emit (node:domain:489:12)\n    at /app/nocobase/node_modules/pg/lib/connection.js:116:12\n    at Parser.parse (/app/nocobase/node_modules/pg-protocol/dist/parser.js:36:17)\n    at Socket.<anonymous> (/app/nocobase/node_modules/pg-protocol/dist/index.js:11:42)\n    at Socket.emit (node:events:524:28)\n    at Socket.emit (node:domain:489:12)\n    at addChunk (node:internal/streams/readable:561:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n    at Readable.push (node:internal/streams/readable:392:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:191:23)","app":"main","reqId":"5326c9d3-b53a-479c-8852-811af36b07ad","timestamp":"2025-04-23 03:27:29"}
{"level":"error","message":"Headers not found. Expected headers: {{headers}}","meta":{"err":"ImportValidationError: Headers not found. Expected headers: {{headers}}\n    at XlsxImporter.findAndValidateHeaders (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:262:11)\n    at XlsxImporter.getData (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:227:46)\n    at XlsxImporter.validate (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:69:29)\n    at XlsxImporter.run (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:78:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async importXlsxAction (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/actions/import-xlsx.js:72:25)\n    at async importXlsx (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/actions/import-xlsx.js:88:5)\n    at async triggerWorkflowActionMiddleware (/app/nocobase/node_modules/@nocobase/plugin-workflow-action-trigger/dist/server/ActionTrigger.js:61:7)\n    at async dataTemplate (/app/nocobase/node_modules/@nocobase/server/lib/middlewares/data-template.js:36:3)\n    at async app.acl.use.after (/app/nocobase/node_modules/@nocobase/plugin-acl/dist/server/server.js:534:9)\n    at async middlewares.add.tag (/app/nocobase/node_modules/@nocobase/acl/lib/acl.js:398:9)\n    at async /app/nocobase/node_modules/@nocobase/acl/lib/allow-manager.js:108:7\n    at async ACLMiddleware (/app/nocobase/node_modules/@nocobase/acl/lib/acl.js:288:14)\n    at async setCurrentRole (/app/nocobase/node_modules/@nocobase/plugin-acl/dist/server/middlewares/setCurrentRole.js:87:3)\n    at async AuthManagerMiddleware (/app/nocobase/node_modules/@nocobase/auth/lib/auth-manager.js:125:7)\n    at async validateFilterParams (/app/nocobase/node_modules/@nocobase/server/lib/middlewares/validate-filter-params.js:39:12)"},"module":"create_course","submodule":"importXlsx","method":"error-handler","app":"main","reqId":"d8907e2d-4efb-48c3-9971-c32dec1f6f50","dataSourceKey":"main","timestamp":"2025-04-23 08:00:26"}
{"level":"error","message":"Import failed at row 148","meta":{"err":"ImportError: Import failed at row 148\n    at XlsxImporter.performImport (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:186:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async XlsxImporter.run (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:79:24)\n    at async importXlsxAction (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/actions/import-xlsx.js:72:25)\n    at async importXlsx (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/actions/import-xlsx.js:88:5)\n    at async triggerWorkflowActionMiddleware (/app/nocobase/node_modules/@nocobase/plugin-workflow-action-trigger/dist/server/ActionTrigger.js:61:7)\n    at async dataTemplate (/app/nocobase/node_modules/@nocobase/server/lib/middlewares/data-template.js:36:3)\n    at async app.acl.use.after (/app/nocobase/node_modules/@nocobase/plugin-acl/dist/server/server.js:534:9)\n    at async middlewares.add.tag (/app/nocobase/node_modules/@nocobase/acl/lib/acl.js:398:9)\n    at async /app/nocobase/node_modules/@nocobase/acl/lib/allow-manager.js:108:7\n    at async ACLMiddleware (/app/nocobase/node_modules/@nocobase/acl/lib/acl.js:288:14)\n    at async setCurrentRole (/app/nocobase/node_modules/@nocobase/plugin-acl/dist/server/middlewares/setCurrentRole.js:87:3)\n    at async AuthManagerMiddleware (/app/nocobase/node_modules/@nocobase/auth/lib/auth-manager.js:125:7)\n    at async validateFilterParams (/app/nocobase/node_modules/@nocobase/server/lib/middlewares/validate-filter-params.js:39:12)\n    at async /app/nocobase/node_modules/@nocobase/plugin-users/dist/server/server.js:223:7\n    at async deleteRolesCache (/app/nocobase/node_modules/@nocobase/plugin-users/dist/server/server.js:212:7)","cause":{"name":"SequelizeUniqueConstraintError","errors":[{"message":"invoice_number must be unique","type":"unique violation","path":"invoice_number","value":"INV20240712-0092","origin":"DB","instance":{"createdAt":"2025-04-23T15:37:30.055Z","updatedAt":"2025-04-23T15:37:30.055Z","start_date":"2024-07-22T00:00:00.000Z","end_date":null,"id":null,"package_id":5,"student_id":74,"salary_id":null,"payment_method":null,"fee":320,"progress":null,"invoice_number":"INV20240712-0092","payment_date":"2024-07-12","transport_fee":null,"total":320,"month_convert":"2024/7","discount":null,"createdById":3,"updatedById":3},"validatorKey":"not_unique","validatorName":null,"validatorArgs":[]}],"parent":{"length":259,"name":"error","severity":"ERROR","code":"23505","detail":"Key (invoice_number)=(INV20240712-0092) already exists.","schema":"public","table":"create_course","constraint":"create_course_invoice_number_key","file":"nbtinsert.c","line":"666","routine":"_bt_check_unique","sql":"INSERT INTO \"public\".\"create_course\" (\"createdAt\",\"updatedAt\",\"package_id\",\"discount\",\"month_convert\",\"id\",\"total\",\"transport_fee\",\"payment_method\",\"fee\",\"progress\",\"student_id\",\"invoice_number\",\"payment_date\",\"start_date\",\"end_date\",\"salary_id\",\"createdById\",\"updatedById\") VALUES ($1,$2,$3,$4,$5,DEFAULT,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18) RETURNING \"createdAt\",\"updatedAt\",\"package_id\",\"discount\",\"month_convert\",\"id\",\"total\",\"transport_fee\",\"payment_method\",\"fee\",\"progress\",\"student_id\",\"invoice_number\",\"payment_date\",\"start_date\",\"end_date\",\"salary_id\",\"createdById\",\"updatedById\";","parameters":["2025-04-23 15:37:30.055 +00:00","2025-04-23 15:37:30.055 +00:00",5,null,"2024/7",320,null,null,320,null,74,"INV20240712-0092","2024-07-12","2024-07-22 00:00:00.000 +00:00",null,null,3,3]},"original":{"length":259,"name":"error","severity":"ERROR","code":"23505","detail":"Key (invoice_number)=(INV20240712-0092) already exists.","schema":"public","table":"create_course","constraint":"create_course_invoice_number_key","file":"nbtinsert.c","line":"666","routine":"_bt_check_unique","sql":"INSERT INTO \"public\".\"create_course\" (\"createdAt\",\"updatedAt\",\"package_id\",\"discount\",\"month_convert\",\"id\",\"total\",\"transport_fee\",\"payment_method\",\"fee\",\"progress\",\"student_id\",\"invoice_number\",\"payment_date\",\"start_date\",\"end_date\",\"salary_id\",\"createdById\",\"updatedById\") VALUES ($1,$2,$3,$4,$5,DEFAULT,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18) RETURNING \"createdAt\",\"updatedAt\",\"package_id\",\"discount\",\"month_convert\",\"id\",\"total\",\"transport_fee\",\"payment_method\",\"fee\",\"progress\",\"student_id\",\"invoice_number\",\"payment_date\",\"start_date\",\"end_date\",\"salary_id\",\"createdById\",\"updatedById\";","parameters":["2025-04-23 15:37:30.055 +00:00","2025-04-23 15:37:30.055 +00:00",5,null,"2024/7",320,null,null,320,null,74,"INV20240712-0092","2024-07-12","2024-07-22 00:00:00.000 +00:00",null,null,3,3]},"fields":{"invoice_number":"INV20240712-0092"},"sql":"INSERT INTO \"public\".\"create_course\" (\"createdAt\",\"updatedAt\",\"package_id\",\"discount\",\"month_convert\",\"id\",\"total\",\"transport_fee\",\"payment_method\",\"fee\",\"progress\",\"student_id\",\"invoice_number\",\"payment_date\",\"start_date\",\"end_date\",\"salary_id\",\"createdById\",\"updatedById\") VALUES ($1,$2,$3,$4,$5,DEFAULT,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18) RETURNING \"createdAt\",\"updatedAt\",\"package_id\",\"discount\",\"month_convert\",\"id\",\"total\",\"transport_fee\",\"payment_method\",\"fee\",\"progress\",\"student_id\",\"invoice_number\",\"payment_date\",\"start_date\",\"end_date\",\"salary_id\",\"createdById\",\"updatedById\";"}},"module":"create_course","submodule":"importXlsx","method":"error-handler","app":"main","reqId":"a6f58ae2-f13e-49da-9cb7-b66dbc0010b6","dataSourceKey":"main","timestamp":"2025-04-23 15:37:30"}
{"level":"error","message":"Validation error","stack":"Error\n    at Query.run (/app/nocobase/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)\n    at /app/nocobase/node_modules/sequelize/lib/sequelize.js:315:28\n    at async PostgresQueryInterface.insert (/app/nocobase/node_modules/sequelize/lib/dialects/abstract/query-interface.js:308:21)\n    at async model.save (/app/nocobase/node_modules/sequelize/lib/model.js:2490:35)\n    at async create_course.create (/app/nocobase/node_modules/sequelize/lib/model.js:1362:12)\n    at async _Repository.create (/app/nocobase/node_modules/@nocobase/database/lib/repository.js:347:22)\n    at async XlsxImporter.performImport (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:174:11)\n    at async XlsxImporter.run (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/services/xlsx-importer.js:79:24)\n    at async importXlsxAction (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/actions/import-xlsx.js:72:25)\n    at async importXlsx (/app/nocobase/node_modules/@nocobase/plugin-action-import/dist/server/actions/import-xlsx.js:88:5)\n    at async triggerWorkflowActionMiddleware (/app/nocobase/node_modules/@nocobase/plugin-workflow-action-trigger/dist/server/ActionTrigger.js:61:7)\n    at async dataTemplate (/app/nocobase/node_modules/@nocobase/server/lib/middlewares/data-template.js:36:3)\n    at async app.acl.use.after (/app/nocobase/node_modules/@nocobase/plugin-acl/dist/server/server.js:534:9)\n    at async middlewares.add.tag (/app/nocobase/node_modules/@nocobase/acl/lib/acl.js:398:9)\n    at async /app/nocobase/node_modules/@nocobase/acl/lib/allow-manager.js:108:7\n    at async ACLMiddleware (/app/nocobase/node_modules/@nocobase/acl/lib/acl.js:288:14)","app":"main","reqId":"a6f58ae2-f13e-49da-9cb7-b66dbc0010b6","timestamp":"2025-04-23 15:37:30"}
